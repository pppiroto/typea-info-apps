<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="list_friends">
  	<Require feature="opensocial-0.8"/>
  </ModulePrefs> 
  <Content type="html">
     <![CDATA[ 
     	<script type="text/javascript">
	        function loadRequest() {
	        	var req = opensocial.newDataRequest();
	        	req.add(req.newFetchPersonRequest("VIEWER"), "viewer");
	        	var fields = ["memo"];
				req.add(req.newFetchPersonAppDataRequest("VIEWER", fields), "viewer_data");
				req.send(loadResponse);
	        }
	        function loadResponse(data) {
	        	var viewer = data.get("viewer").getData();
	        	var viewer_data = data.get("viewer_data");
	        	if (viewer_data.hadError()) {
	        		document.getElementById("message").innerHTML = data.getErrorMessage();
	        		return;
	        	}
	        	var dataAry = viewer_data.getData()[viewer.getId()];
	        	var memo = dataAry["memo"];
	        	var txtMemo = document.getElementById("memo");
	        	txtMemo.value = gadgets.util.unescapeString(memo);
				txtMemo.disabled = false;	        	
	        }
	        function registRequest() {
				var req = opensocial.newDataRequest();
	        	var key = "memo";
	        	var txtMemo = document.getElementById("memo");
	        	txtMemo.disabled = true;
	        	req.add(req.newUpdatePersonAppDataRequest("VIEWER", key, txtMemo.value));
	        	req.send(registResponse);
	        }
	        function registResponse(data) {
	        	if (data.hadError()) {
	        		document.getElementById("message").innerHTML = data.getErrorMessage();	
	        		return;
	        	}
	        	loadRequest();
	        }
	        function removeRequest() {
	        	var req = opensocial.newDataRequest();
	        	var fields = ["memo"];
	        	req.add(req.newRemovePersonAppDataRequest("VIEWER", fields), "viewer_data");
	        	req.send(loadResponse);
	        }
	        gadgets.util.registerOnLoadHandler(loadRequest);
       	</script>
       	<div id="message"/>
		<textarea id="memo" rows="3" cols="20">
		</textarea>
		<br/>
		<input type="button" id="regist" value="登録" onclick="registRequest();"/>
		<input type="button" id="remove" value="削除" onclick="javascript:removeRequest();"/>
     ]]>
  </Content> 
</Module>
