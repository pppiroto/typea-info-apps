<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
  <ModulePrefs title="twitter search sample">
  	<Require feature="opensocial-0.8"/>
  </ModulePrefs> 
  <Content type="html">
     <![CDATA[ 
     	<script type="text/javascript">
	     	/**
	     	 * mixi アプリ :
	     	 * @see http://apiwiki.twitter.com/Twitter-Search-API-Method%3A-search
	     	 * @see http://code.google.com/intl/ja/apis/gadgets/docs/remote-content.html#Fetch_JSON
	     	 */
     		function search_twitter() {
     			var search_word = document.getElementById('search_word').value;
     			
     			var url = "http://search.twitter.com/search.json";
     			url += ("?q=" + encodeURIComponent(search_word));

     			var params = {};
	    		params[gadgets.io.RequestParameters.METHOD] = gadgets.io.MethodType.GET;
	    		params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
     			gadgets.io.makeRequest(url, searchResponse, params);
     		}
     		function searchResponse(responseObj) {
     			var jsondata = responseObj.data
		      	document.getElementById('content_div').innerHTML = printPropertiesAsTable(jsondata, 0);
		      	
     		}

            // 閲覧者情報表示
            function printPropertiesAsTable(obj, dpth) {
                if (dpth > 5) {
                    return "<b>parse limit over</b>";
                }
                var tbl = "<table border='1'>";
                tbl += "<tr><th>Property</th><th>Type</th><th>Value</th></tr>";
                for (prop in obj) {
                    var type  = typeof(eval("obj." + prop));
                    var blnkt = (type == "function")?"()":""; 
                    tbl += "<tr>";
                    tbl += "<td>" + prop + "</td>";
                    tbl += "<td>" + type + "</td>";
                    if (type == 'object') {
                        tbl += "<td>" + printPropertiesAsTable(eval("obj." + prop), dpth++) + "</td>"; 
                    } else {
                        tbl += "<td>" + eval("obj." + prop + blnkt) + "</td>";
                    }
                    tbl += "</tr>";
                }
                tbl += "</table>";
                return tbl;
            }

     		
       	</script>
       	<input type="text" size="10" id="search_word"/><input type="button" name="search" value="search" onclick="javascript:search_twitter();"/>
       	<div id="content_div"/>
     ]]>
  </Content> 
</Module>
